---
title: 网络流求最大闭合子图:序
date: 2019-03-04 17:07
update: 2019-03-04 17:07
author: Rainboy
---

## 学习思路

```viz-dot
digraph G {
    //ranksep=1;
    node[shape="rect"];
    "闭合图"->"最大闭合子图"->"转成网络";
    "转成网络"->"求最大流(最小割)"->
    {
        "最大闭合子图权值和=正权值和 - MaxFlow",
        "最大闭合子图在S的集合中"
    }
}
```
## 闭合图

有向连通图，每个点带有一个权值,如下:

那么**闭合图**:在一个图中，我们选取一些点构成集合，记为V，如果集合V中的每个点的后趋都出在集合中,则我们称V为闭合图。


**最大权闭合子图**:点的上权值全最大的闭合子图

### 转换

此时，构建一个超级源点S，一个超级汇点T，所有的点按权值的正负连接到S和T上，转换成一个边权值有向图，如下图：

### 简单割

**简单割**：割集中所有的边，都与S或T相连接。

该带边权有向图的关于S-T最小割，是简单割.

显然的，因为不与S,T相连的边，权值都是INF，最小割不可能割在INF的边上；

### 简单割与原图中的闭合子图一一对应

该图中的每一个简单割产生的两个子图，我们记含有点S的是图S，含有点T的是图T，则图S是闭合图；

证明：简单割内不包含边权为INF的边，即不含有连通两个图的边（除了连接在t点上的边之外）；
即，图S中没有边与图T连通，那么，所有的边都只能连接在图S之内，即为闭合图。

样例：

### S为最大闭合子图

首先我们记一个简单割的容量为$C$,且S所在集合为$N$，T所在集合为$M$。

 - 如果负权点连接$T$的边是割边,证明对应的负权点被选择了,
 - 如果$S$连接正权的边是割边,证明对应的正权点被抛弃了

则C=M中所有权值为正的点的权值(即S与M中点相连的边的容量)+N中所有权值为负的点权值的绝对值(即N中点与T中点相连边的容量)。记($C=x1+y1$);(很好理解，不理解画一个图或想象一下就明白了)。

我们记N这个闭合图的权值和为W。

则W=N中权值为正的点的权值-N中权值为负的点的权值的绝对值。记(W=x2-y2);

则W+C=x1+y1+x2-y2。

因为明显y1=y2，所以W+C=x1+x2;

x1为M中所有权值为正的点的权值，x2为N中权值为正的点的权值。

所以x1+x2=所有权值为正的点的权值之和(记为TOT).

所以我们得到W+C=TOT.整理一下W=TOT-C.

到这里我们就得到了闭合图的权值与简单割的容量的关系。

因为TOT为定值，所以我们欲使W最大，即C最小，即此时这个简单割为最小割，此时闭合图为其源点S所在集合(除去S)。得正。

最后，我们就有了求解这类问题的完整思路：

先建
 - 先记录整个图中，所有正点权值的和；
 - 建立对应流网络，求最大流，最大流在数值上等于最小割，故我们得到了流网络的s-t最小割；
 - “所有正点权值的和”减去“s-t最小割”，即得最大权闭合子图的权值和。

<easy-memory-board size="2">
    <p slot="title">记忆要点</p>
    <li>1.最小割 = 不选的正权和+ |要选的负权和|</li>
    <li>2.最大闭合子图=所有正权和- 不选的正权和- |要选的负权和|</li>
    <li>3.最大闭合子图=所有正权和- 最小割</li>
</easy-memory-board>


## 练习题目

 - luogu p3410
 - [poj-2987](https://vjudge.net/problem/POJ-2987)

## 引用/参考

- [Dilthey's Blog-最大权闭合子图 - 求最大点权的闭合子图 ](https://www.cnblogs.com/dilthey/p/7565206.html)
- [网络流——最小割求最大权闭合子图](https://blog.csdn.net/can919/article/details/77603353)
